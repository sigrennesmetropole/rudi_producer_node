#•••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••
#
# [- LIST OF CHANGES -]
#
# [1.1.0]
#   - Heavy restructuration that keeps only the required properties for Metadata
#   - 'RudiID' scheme deleted and replaced by 'UUIDv4'
#   - 'File' renamed in 'MediaFile'
#   - 'Series' renamed in 'MediaSeries'
#   - 'lang' parameter removed from 'resources' routes
#   - 'abstract' renamed in 'synopsis'
#   - 'minimum' is incorrect for arrays -> 'minItems'
#   - IntegrationReport.version is now a string
#
# [1.2.0]
#   - Schemas 'SkosConcept' and 'SkosScheme'
#   - Added 'access_condition' and especially 'access_condition.licence'
#   - Licence, LicenceCustom and LicenceStandard schemas
#   - $ref: 'UUIDv4' replaced by {type: string; format: uuid}.
#   - 'UUIDv4' schema deleted
#   -
#
#•••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••
openapi: 3.0.0
info:
  version: 1.2.0
  title: rudi-proxi-api
  description: "API pour l'accès aux données au niveau du nœud producteur RUDI"
  termsOfService: 'no'
  contact:
    name: Olivier Martineau
    email: 'community@rudi-univ-rennes1.fr'
  license:
    name: GPLv3
    url: 'https://www.gnu.org/licenses/gpl-3.0.html'

#•••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••
#servers:
#- url: https://rudi-server/api/v1

#•••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••
# DEFINITIONS
# - 'Portal': the main RUDI catalog for all metadata in the RUDI system
# - 'Producer node': The RUDI node where data is produced and published with its
#                    metadata
# - 'Producer': Entity that produces the data on the Producer node
# - 'Provider': Entity that publishes the data and metadata on the Producer node
# - 'Resource': concerns both data and metadata for a designated resource
# - 'Metadata': the metadata for a designated resource
# - 'Data': the data for a designated resource

#•••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••
tags:
  - name: Metadata
  - name: Organization
  - name: Contact
  - name: Report

#•••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••
paths:
  #=============================================================================
  # METADATA
  #=============================================================================
  '/resources/{id}':
    summary: Access the metadata for one identified resource
    parameters:
      - name: 'id'
        description: Unique id of the resource
        in: path
        required: true
        schema:
          type: string
          format: uuid
    'get':
      tags:
        - Metadata
      description: Returns the metadata for the identified resource
      # - links for downloading the resource?
      # - can we access a metadata but not the resource?
      operationId: getMetadata
      security:
        - authRudi: [portal, backoffice]
      responses:
        '200':
          description: All metadata for the identified resource
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Metadata'
        # These errors are the standard error responses for every query
        '400':
          $ref: '#/components/responses/Error400BadRequest'
        '401':
          $ref: '#/components/responses/Error401Unauthorized'
        '403':
          $ref: '#/components/responses/Error403Forbidden'
        '404':
          $ref: '#/components/responses/Error404NotFound'
        '405':
          $ref: '#/components/responses/Error405MethodNotAllowed'
        '406':
          $ref: '#/components/responses/Error406NotAcceptable'
        '408':
          $ref: '#/components/responses/Error408RequestTimeout'
        '410':
          $ref: '#/components/responses/Error410Gone'
        '423':
          $ref: '#/components/responses/Error423Locked'
        '429':
          $ref: '#/components/responses/Error429TooManyRequests'
        '500':
          $ref: '#/components/responses/Error500InternalServerError'
        '503':
          $ref: '#/components/responses/Error503ServiceUnavailable'

    #=============================================================================
    # '/resources/{id}':
    'delete':
      tags:
        - Metadata
      description: Deletes one identified resource
      # - should we keep the metadata for some time?
      # - see above: can we access a metadata but not the resource?
      operationId: deleteResource
      security:
        - authRudi: [backadmin]
      responses:
        '200':
          description: Resource successfully deleted.
          content:
            application/json:
              schema:
                # The deleted resource
                $ref: '#/components/schemas/Metadata'

  #=============================================================================
  '/resources':
    summary: Access the metadata for a set of resources
    'get':
      summary: Access the metadata for every resource
      description: Returns an array of the metadata of every resource
      #TODO:
      # - add some meta info on the set of metadata?
      # - access the metadata for several *identified* resources?
      # - links for downloading every resource?
      # - can we access a metadata but not the resource?
      tags:
        - Metadata
      operationId: getMetadataList
      security:
        - authRudi: [portal, backoffice]
      parameters:
        - name: 'limit'
          description: Max number of resource to return
          in: query
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 500 #default MAX to limit the server overload
          example: 100
        - name: 'offset'
          description: Index of the first line of resources to display
          in: query
          schema:
            type: integer
            format: int32
            minimum: 0
            example: 1
      responses:
        '200':
          description: Metadata for every resource
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Metadata'
        '206':
          description: Metadata for a subset of the resources
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Metadata'

    #=============================================================================
    #'/resources':
    'post':
      tags:
        - Metadata
      description: Create one new resource
      operationId: addResource
      security:
        - authRudi: [backoffice]
          # NOTES:
          # - the request implies global_id is present in the body, so
          #   '/resources/{id}' is redundant
          # - the uploader chooses the global_ids!
          # - the resource global_id should not exist already, or the upload will
          #   fail
          # - data in the proxi/organization node + metadata both on producer node
          #   AND on RUDI catalog node
      requestBody:
        content:
          application/json:
            schema:
              # The added resource
              $ref: '#/components/schemas/Metadata'

      responses:
        '202':
          description: The creation of the resource has been initiated.

    #=============================================================================
    #'/resources':
    'put':
      tags:
        - Metadata
      description: Update data and metadata on the Proxi/organization node for one identified
        resource
      operationId: updateResource
      security:
        - authRudi: [backoffice]
          # NOTES:
          # - the request implies global_id is present in the body, so
          #   '/resources/{id}' is redundant
          # - the resource global_id should exist already, or the upload will fail
          # - data is located on the proxi/organization node, metadata both on
          #   producer node and on RUDI catalog node
      requestBody:
        content:
          application/json:
            schema:
              # The updated resource
              $ref: '#/components/schemas/Metadata'
      responses:
        '202':
          description: The update of the resource has been initiated

    #=============================================================================
    #'/resources':
    'delete':
      tags:
        - Metadata
      description: Delete every metadata on the Proxi/organization node
      operationId: deleteEveryResource
      security:
        - authRudi: [backadmin]
          # NOTES:
          # - the request implies global_id is present in the body, so
          #   '/resources/{id}' is redundant
          # - the resource global_id should exist already, or the upload will fail
          # - data is located on the proxi/organization node, metadata both on
          #   producer node and on RUDI catalog node
      responses:
        '202':
          description: The deletion of the resource has been initiated

  #=============================================================================
  '/resources/deletion':
    'post':
      tags:
        - Metadata
      description:
        Delete data on the Proxi/organization node for several identified resources
        #TODO: and metadata? After e.g. a year?
      operationId: deleteResources
      security:
        - authRudi: [backadmin]
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                format: uuid
      responses:
        '202':
          description: The deletion of the resources has been initiated.

  #=============================================================================
  # ORGANIZATION
  #=============================================================================
  '/organizations/{id}':
    summary: Access the metadata for an identified organization
    parameters:
      - name: 'id'
        description: Unique id of the organization
        in: path
        required: true
        schema:
          type: string
          format: uuid
    'get':
      tags:
        - Organization
      description: Returns the metadata for the identified organization
      operationId: getOrganization
      security:
        - authRudi: [portal, backoffice]
      responses:
        '200':
          description: All metadata for the identified organization
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Organization'

    #=============================================================================
    #'/organizations/{id}':
    'delete':
      tags:
        - Organization
      description:
        Deletes one identified organization
        # - action will fail for a organization that still has resources attached
      operationId: deleteOrganization
      security:
        - authRudi: [backadmin]
      responses:
        '200':
          description: Organization successfully deleted
          content:
            application/json:
              schema:
                # The deleted resource
                $ref: '#/components/schemas/Organization'

  #=============================================================================
  '/organizations':
    'get':
      tags:
        - Organization
      description: Access the data for a set of organizations
      operationId: getOrganizationList
      security:
        - authRudi: [portal, backoffice]
      parameters:
        - name: 'limit'
          description: Max number of organizations to return
          in: query
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 500 #default MAX to limit the server overload
          example: 100
        - name: 'offset'
          description: Index of the first line of organizations to display
          in: query
          schema:
            type: integer
            format: int32
            minimum: 0
            example: 1
      responses:
        '200':
          description: Metadata for every organization
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Organization'
        '206':
          description: Metadata for a subset of the organizations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Organization'

    #=============================================================================
    # '/organizations':
    'post':
      tags:
        - Organization
      description: Create one new organization in RUDI system
      operationId: addOrganization
      security:
        - authRudi: [backoffice]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Organization'
      responses:
        '202':
          description: The creation of the organization has been initiated

    #=============================================================================
    # '/organizations':
    'put':
      tags:
        - Organization
      description: Updates one organization in RUDI system
      operationId: updateOrganization
      security:
        - authRudi: [backoffice]
          # NOTES:
          # - the request implies organization ID is present in the body, so
          #   '/organizations/{id}' is redundant
          # - the organization ID should exist already, or the upload will fail
      requestBody:
        content:
          application/json:
            schema:
              # The updated organization
              $ref: '#/components/schemas/Organization'
      responses:
        '202':
          description: The update of the organization has been initiated

  #=============================================================================
  '/organizations/deletion':
    'post':
      tags:
        - Organization
      description:
        Delete data on the Producer node for several identified organizations
        # - action will fail for every organization that still has resources attached
      operationId: deleteOrganizations
      security:
        - authRudi: [backadmin]
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                format: uuid
      responses:
        '202':
          description: The deletion of the organizations has been initiated

  #=============================================================================
  # CONTACT
  #=============================================================================
  '/contacts/{id}':
    summary: Access the metadata an identified contacts
    parameters:
      - name: 'id'
        description: Unique id of the contact
        in: path
        required: true
        schema:
          type: string
          format: uuid
    'get':
      tags:
        - Contact
      description: Returns the metadata for the identified contact
      operationId: getContact
      security:
        - authRudi: [portal, backoffice]
      responses:
        '200':
          description: All metadata for the identified contact
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Contact'

    #=============================================================================
    #'/contacts/{id}':
    'delete':
      tags:
        - Contact
      description:
        Deletes one identified contact
        # - action will fail for a contact that still has resources attached
      operationId: deleteContact
      security:
        - authRudi: [backadmin]
      responses:
        '200':
          description: Contact successfully deleted.
          content:
            application/json:
              schema:
                # The deleted resource
                $ref: '#/components/schemas/Contact'

  #=============================================================================
  '/contacts':
    'get':
      tags:
        - Contact
      description: Access the data for a set of contacts
      operationId: getContactList
      security:
        - authRudi: [portal, backoffice]
      parameters:
        - name: 'limit'
          description: Max number of contacts to return
          in: query
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 500 #default MAX to limit the server overload
          example: 100
        - name: 'offset'
          description: Index of the first line of contacts to display
          in: query
          schema:
            type: integer
            format: int32
            minimum: 0
            example: 1
      responses:
        '200':
          description: Metadata for every contact
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Contact'
        '206':
          description: Metadata for a subset of the contacts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Contact'

    #=============================================================================
    # '/contacts':
    'post':
      tags:
        - Contact
      description: Create one new contact in RUDI system
      operationId: addContact
      security:
        - authRudi: [backoffice]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Contact'
      responses:
        '202':
          description: The creation of the contact has been initiated

    #=============================================================================
    # '/contacts':
    'put':
      tags:
        - Contact
      description: Updates one contact
      operationId: updateContact
      security:
        - authRudi: [backoffice]
          # NOTES:
          # - the request implies contact_id is present in the body, so
          #   '/contacts/{id}' is redundant
          # - the contact_id should exist already, or the upload will fail
      requestBody:
        content:
          application/json:
            schema:
              # The updated contact
              $ref: '#/components/schemas/Contact'
      responses:
        '202':
          description: The update of the contact has been initiated

  #=============================================================================
  '/contacts/deletion':
    'post':
      tags:
        - Contact
      description:
        Delete data on the Proxi/organization node for several identified contacts
        # - action will fail for every contact that still has resources attached
      operationId: deleteContacts
      security:
        - authRudi: [backadmin]
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                format: uuid
      responses:
        '202':
          description: The deletion of the contacts has been initiated.

  #=============================================================================
  # REPORT
  #=============================================================================
  '/resources/{id}/report':
    parameters:
      - name: 'id'
        description: Unique id of the resource
        in: path
        required: true
        schema:
          type: string
          format: uuid
    'post':
      tags:
        - Report
      description: >
        Action called when receiving an ackowledgement for an integration
        operation from the Portal
      operationId: addIntegrationReport
      security:
        - authRudi: [node]
      #TODO maybe such operation should stay private
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IntegrationReport'
      responses:
        '202':
          description: A new report was created.
    'put':
      tags:
        - Report
      description: Report from the Portal on the result of a previous operation request
      operationId: updateIntegrationReport
      security:
        - authRudi: [portal]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IntegrationReport'
      responses:
        '202':
          description: The report has been received.

  #=============================================================================
  '/organizations/{id}/report':
    parameters:
      - name: 'id'
        description: Unique id of the organization
        in: path
        required: true
        schema:
          type: string
          format: uuid
    'post':
      tags:
        - Report
      description: >
        Action called when receiving an ackowledgement for an integration
        operation from the Portal
      operationId: addOrganizationIntegrationReport
      security:
        - authRudi: [node]
      #TODO maybe such operation should stay private
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IntegrationReport'
      responses:
        '202':
          description: A new report was created.
    'put':
      tags:
        - Report
      description: Report from the Portal on the result of a previous operation request
      operationId: updateOrganizationReport
      security:
        - authRudi: [portal]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IntegrationReport'
      responses:
        '202':
          description: The report has been received.
  #=============================================================================
  '/contacts/{id}/report':
    parameters:
      - name: 'id'
        description: Unique id of the resource
        in: path
        required: true
        schema:
          type: string
          format: uuid
    'post':
      tags:
        - Report
      description: >
        Action called when receiving an ackowledgement for an integration
        operation from the Portal
      operationId: addContactIntegrationReport
      security:
        - authRudi: [node]
      #TODO maybe such operation should stay private
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IntegrationReport'
      responses:
        '202':
          description: A new report was created.
    'put':
      tags:
        - Report
      description: Report from the Portal on the result of a previous operation request
      operationId: updateContactReport
      security:
        - authRudi: [portal]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IntegrationReport'
      responses:
        '202':
          description: The report has been received.

#•••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••
components:
  #=============================================================================
  # See schemas definitions at
  # https://github.com/sigrennesmetropole/rudi_documentation/tree/main/schemas
  #=============================================================================
  schemas:
    #---------------------------------------------------------------------------
    'Metadata':
      type: object
      required:
        - global_id

        - resource_title
        - synopsis
        - summary

        - theme
        - keywords

        - producer
        - contacts

        - available_formats

        #- temporal_spread
        #- geography
        - dataset_dates
        - storage_status

        - access_condition

        - metadata_info

      properties:
        #—•—•—•—•—•—•—•—•—•—•—•—•—•
        # RESOURCE IDENTIFICATION
        #——————————————————————————
        'global_id':
          type: string
          format: uuid

        #——————————————————————————
        'local_id':
          description: Identifier in the data producer system
          type: string
          #TODO: Constraints?
          # - pattern for avoiding spaces and unusal characters?
          # - max lenght?
          example: '2020.11-Laennec-AQMO-air quality sensors measures'

        #——————————————————————————
        'doi':
          $ref: '#/components/schemas/DOI'

        #—•—•—•—•—•—•—•—•—•—•—•—•—•
        # DATASET DESCRIPTION
        #——————————————————————————
        'resource_title':
          description: Simple name for the resource
          type: string
          maxLength: 150
          example: "Données de capteurs de la qualité de l'air, novembre 2020, Laënnec"
        # !DICO!

        #——————————————————————————
        'synopsis':
          description: Short description for the whole dataset
          type: array
          items:
            $ref: '#/components/schemas/DictionaryEntry'
          minItems: 1
          # TODO: size ≤ 150
        # !DICO!

        #——————————————————————————
        'summary':
          description: More precise description for the whole dataset
          type: array
          items:
            $ref: '#/components/schemas/DictionaryEntry'
          minItems: 1
          # TODO: size ≤ 500
        # !DICO!

        #—•—•—•—•—•—•—•—•—•—•—•—•—•
        # CLASSIFICATION
        #——————————————————————————
        'theme':
          $ref: '#/components/schemas/Theme'
        # !SKOS!

        #——————————————————————————
        'keywords':
          description: List of tags that can be used to retrieve the data
          type: array
          items:
            $ref: '#/components/schemas/Keyword'
        # !SKOS!

        #—•—•—•—•—•—•—•—•—•—•—•—•—•
        # INVOLVED PARTIES
        #——————————————————————————
        'producer':
          $ref: '#/components/schemas/Organization'

        #——————————————————————————
        'contacts':
          description: Address to ask details on the dataset and its production
          type: array
          items:
            $ref: '#/components/schemas/Contact'

        #—•—•—•—•—•—•—•—•—•—•—•—•—•
        # CONTAINER DESCRIPTION
        #——————————————————————————
        'available_formats':
          description: Available formats
          type: array
          items:
            $ref: '#/components/schemas/Media'

        #—•—•—•—•—•—•—•—•—•—•—•—•—•
        # DATASET INFO
        #——————————————————————————
        'resource_languages':
          description: Languages available in the dataset, if relevant
          type: array
          items:
            $ref: '#/components/schemas/Language'
          default: [fr]

        #——————————————————————————
        'temporal_spread':
          description: >
            Period of time described by the data.
            If the end date is not known (because the resource is still valid in
            the present for instance, the end_date field will be left blank)
            For a one-time measurement, one can fill both start and end date
            with the same value.
          type: object
          required:
            - start_date
          properties:
            #......................
            'start_date':
              $ref: '#/components/schemas/Date'
            #......................
            'end_date':
              $ref: '#/components/schemas/Date'

        #——————————————————————————
        'geography':
          description: Geographic localisation of the data
          type: object
          required:
            - bounding_box
          properties:
            #......................
            'bounding_box':
              description: >
                Geographic distribution of the data as a rectangle.
                The 4 parameters are given as decimal as described in the
                norm ISO 6709
              type: object
              required:
                - west_longitude
                - east_longitude
                - north_latitude
                - south_latitude
              properties:
                'north_latitude':
                  description: Northernmost latitude given as a decimal number (norm ISO 6709)
                  type: number
                  minimum: -90
                  maximum: 90
                'south_latitude':
                  description: Southernmost latitude (decimal number, norm ISO 6709)
                  type: number
                  minimum: -90
                  maximum: 90
                'west_longitude':
                  description: Westernmost latitude (decimal number, norm ISO 6709)
                  type: number
                  minimum: -180
                  maximum: 180
                'east_longitude':
                  description: Easternmost latitude (decimal number, norm ISO 6709)
                  type: number
                  minimum: -180
                  maximum: 180
            #......................
            'geographic_distribution':
              allOf:
                - description: Precise geographic distribution of the data
                  type: object
                - $ref: 'https://app.swaggerhub.com/apis/OlivierMartineau/GeoJSON/#/schemas/GeoJsonObject'
            #......................
            'projection':
              description: Cartographic projection used to describe the data
              type: string
              example:
                'WGS 84 (EPSG:4326)'
                # 'RGF93/Lambert-93 (EPSG:2154)'
                # 'RGF93/CC48 (EPSG:3948)'
              #TODO: 'Projection' thesaurus

        #——————————————————————————
        'dataset_size':
          description: Indicative total size of the data
          type: object
          properties:
            #......................
            'numbers_of_records':
              type: integer
              minimum: 0
            #......................
            'number_of_fields':
              type: integer
              minimum: 0

        #——————————————————————————
        'dataset_dates':
          allOf:
            - description: Dates of the actions performed on the data (creation, publishing, update, deletion...)
              type: object
            - $ref: '#/components/schemas/ReferenceDates'

        #——————————————————————————
        'storage_status':
          description: >-
            Status of the storage of the dataset
            Metadata can exist without the data
            - online      = data are published and available
            - archived    = data are not immediately available, access is not automatic
            - unavailable = data were deleted
          type: string
          enum: [online, archived, unavailable]
        # !SKOS!

        #—•—•—•—•—•—•—•—•—•—•—•—•—•
        # ACCESS CONSTRAINTS
        #——————————————————————————
        'access_condition':
          description: >
            Access restrictions for the use of data in the form of licence,
            confidentiality, terms of service, habilitation or required rights,
            economical model. Default is open licence.
            #TODO: to be defined. Possible redundencies with other fields!
          type: object
          required:
            - licence
          properties:
            #......................
            'confidentiality':
              description: Restriction level for the resource
              type: object
              properties:
                'restricted_access':
                  description: >
                    True if the dataset has a restricted access.
                    False for open data
                  type: boolean
                'gdpr_sensitive':
                  description: >
                    True if the dataset embeds personal data
                  type: boolean
            #......................
            'licence':
              $ref: '#/components/schemas/Licence'
            #......................
            'usage_constraint':
              description: >
                Describes how constrained is the use of the resource
              type: array
              items:
                $ref: '#/components/schemas/DictionaryEntry'
              example:
                {
                  'lang': 'fr',
                  'text': 'Usage libre sous réserve des mentions obligatoires sur tout document de diffusion',
                }
            #......................
            'bibliographical_reference':
              description: >
                Information that MUST be cited every time the data is used,
                most likely a BibTeX entry
              type: array
              items:
                $ref: '#/components/schemas/DictionaryEntry'
            #......................
            'mandatory_mention':
              description: >
                Mention that must be cited verbatim in every publication that
                makes use of the data
              type: array
              items:
                $ref: '#/components/schemas/DictionaryEntry'
              minItems: 1
              example: { 'lang': 'fr-FR', 'text': 'Source: Région Bretagne' }
            #......................
            'access_constraint':
              type: array
              items:
                $ref: '#/components/schemas/DictionaryEntry'
            #......................
            'other_constraints':
              type: array
              items:
                $ref: '#/components/schemas/DictionaryEntry'
              example: { 'lang': 'fr', 'text': "Pas de restriction d'accès public" }

        #—•—•—•—•—•—•—•—•—•—•—•—•—•
        # METADATA INFO
        #——————————————————————————
        'metadata_info':
          description: Metadata on the metadata
          type: object
          required:
            - api_version
          properties:
            #......................
            'api_version':
              type: string
              pattern: '([0-9]{1,2}\.){2}[0-9]{1,2}[a-z]*'
            #......................
            'metadata_dates':
              $ref: '#/components/schemas/ReferenceDates'
            #......................
            'metadata_provider':
              allOf:
                - description: Description of the organization that produced the metadata
                  type: object
                - $ref: '#/components/schemas/Organization'
            #......................
            'metadata_contacts':
              description: Addresses to get further information on the metadata
              type: array
              items:
                $ref: '#/components/schemas/Contact'

    #---------------------------------------------------------------------------
    'Organization': # Organization
      description: Entity that produced the data or provided the associated metadata
      type: object
      required:
        - organization_id
        - organization_name
      properties:
        #——————————————————————————
        'organization_id':
          description: Unique identifier of the organization in RUDI system
          type: string
          format: uuid
        #——————————————————————————
        'organization_name':
          description: Updated offical name of the organization
          type: string
        #——————————————————————————
        'organization_address':
          description: Updated offical postal address of the organization
          type: string

    #---------------------------------------------------------------------------
    'Contact':
      description: Address to get further information on the resource
      type: object
      required:
        - contact_id
        - contact_name
        - email
      properties:
        #——————————————————————————
        'contact_id':
          type: string
          format: uuid
        #——————————————————————————
        'organization_name':
          description: Updated offical name of the organization
          type: string
        #——————————————————————————
        'contact_name':
          description: Updated name of the service, or possibly the person
          type: string
        #——————————————————————————
        'role':
          description: Updated status of the contact person
          type: string
          example: Administrator
        #——————————————————————————
        'email':
          description: >
            E-mail address, possibly not nominative to be less dependent
            on changes in the organization, and comply more easily with
            RGPD rules
          type: string
          format: email
          #TODO: RGPD compliant!

    #---------------------------------------------------------------------------
    'Licence':
      description: Abstract object from which standard and custom licences inherit
      type: object
      required:
        - licence_type
      properties:
        #——————————————————————————
        'licence_type':
          type: string
          enum: ['STANDARD', 'CUSTOM']

      discriminator:
        propertyName: licence_type
        mapping:
          'STANDARD': '#/components/schemas/LicenceStandard'
          'CUSTOM': '#/components/schemas/LicenceCustom'

    #---------------------------------------------------------------------------
    'LicenceStandard':
      allOf:
        - $ref: '#/components/schemas/Licence'
        - description: Standard license (recognized by RUDI system)
          type: object
          required:
            - licence_label
          properties:
            'licence_label':
              description: Value of the field SkosConcept.concept_code
              type: string
              format: skosConceptCode

      #---------------------------------------------------------------------------
    'LicenceCustom':
      allOf:
        - $ref: '#/components/schemas/Licence'
        - description: Custom license
          type: object
          required:
            - custom_licence_label
            - custom_licence_uri
          properties:
            'custom_licence_label':
              description: Title of the custom licence
              type: array
              items:
                $ref: '#/components/schemas/DictionaryEntry'
            'custom_licence_uri':
              description: URL towards the custom licence
              type: string
              format: URI

    #---------------------------------------------------------------------------
    'Media':
      description: Abstract object from which File and Series inherit
      type: object
      required:
        - media_type
        - media_id
        - connector
      properties:
        #——————————————————————————
        'media_type':
          description: Transmission mode (file | series)
          type: string
          enum: ['FILE', 'SERIES']
        #——————————————————————————
        'media_id':
          type: string
          format: uuid
        #——————————————————————————
        'connector':
          $ref: '#/components/schemas/Connector'

      discriminator:
        propertyName: media_type
        mapping:
          'FILE': '#/components/schemas/MediaFile'
          'SERIES': '#/components/schemas/MediaSeries'

    #---------------------------------------------------------------------------
    'MediaFile':
      allOf:
        - $ref: '#/components/schemas/Media'
        - description: Description of the container of data as a file
          type: object
          required:
            - file_type
            - file_size
            - checksum
          properties:
            #——————————————————————————
            'file_type':
              # File type (determined automatically)
              $ref: '#/components/schemas/MediaType'

            #——————————————————————————
            'file_size':
              description: >
                Size of the file, in bytes
                (determined automatically)
              type: integer

            #——————————————————————————
            'checksum':
              description: Hash that makes it possible to check the a file intergrity
                (determined automatically)
              type: object
              required:
                - algo
                - hash
              properties:
                'algo':
                  $ref: '#/components/schemas/HashAlgorithm'
                'hash':
                  type: string

            #——————————————————————————
            'file_structure':
              description: >
                Link towards the resource that describes the structure of the data
                (language, norm, data structure, JSON schema, OpenAPI, etc.)
              type: string
              format: URI
              #'URI definition - https://tools.ietf.org/html/rfc2396'

            #——————————————————————————
            'file_encoding':
              description: Source encoding of the data
                (determined automatically)
              type: string
              #format:
              #ISO/CEI 10646'
              #TODO: thesaurus for encoding

    #---------------------------------------------------------------------------
    'MediaSeries':
      allOf:
        - $ref: '#/components/schemas/Media'
        - description: Description of the container of data as a file
          type: object
          properties:
            #——————————————————————————
            'latency':
              description: >
                Theorical delay between the production of the record and its availability,
                in milliseconds.
              type: integer
              minimum: 0

            #——————————————————————————
            'period':
              description: Theorical delay between the production of two records, in milliseconds.
              type: integer
              minimum: 0

            #——————————————————————————
            'current_number_of_records':
              description: Actual number of records
              type: integer
              minimum: 0

            #——————————————————————————
            'current_size':
              description: Actual size of the data, in bytes (refreshed automatically)
              type: integer
              minimum: 0

            #——————————————————————————
            'total_number_of_records':
              description: Estimated total number of records
              type: integer
              minimum: 0

            #——————————————————————————
            'total_size':
              description: Estimated total size of the data, in bytes
              type: integer
              minimum: 0

    #---------------------------------------------------------------------------
    'Connector':
      description: >
        Direct access to the dataset.
        In the case of open data without access restriction, this can be a
        simple download link e.g. a URL
        The interface contract chosen can enable request with specified
        parameters, or make it possible to extract a GeoWMS or a GeoWFS
        If it is not defined, the link should be a direct download link.
      type: object
      required:
        - url
      properties:
        #——————————————————————————
        'url':
          type: string
          format: URI
        #——————————————————————————
        'interface_contract':
          description: Link towards the interface contract defined with RUDI Portal
          type: string

    #---------------------------------------------------------------------------
    'IntegrationError':
      required:
        - error_code
        - error_message
      properties:
        'error_code':
          type: integer
        'error_message':
          type: string
        'field_name':
          type: string

    #---------------------------------------------------------------------------
    'IntegrationReport':
      required:
        - report_id
        - resource_id
      properties:
        #——————————————————————————
        'report_id':
          description: Unique identifier of the integration report
          type: string
          format: uuid
        #——————————————————————————
        'resource_id':
          type: string
          format: uuid
        #——————————————————————————
        'resource_title':
          type: string
          description: Simple name of the resource
        #——————————————————————————
        'submission_date':
          allOf:
            - description: >
                Date when the integration request was submitted by the
                Producer node
              type: string
            - $ref: '#/components/schemas/Date'
        #——————————————————————————
        'treatment_date':
          allOf:
            - description: Date when the integration request was processed by the Portal
              type: string
            - $ref: '#/components/schemas/Date'
        #——————————————————————————
        'method':
          description: Method used by the Producer node for the integration request
          type: string
          enum: [POST, PUT, DELETE]
        #——————————————————————————
        'version':
          description: Version number of the integration contract used for the file
          type: string
          # pattern: '^[0-9]{1,2}\.[0-9]{1,2}(\.[0-9]{1,2})?[a-z]*$'
        #——————————————————————————
        'integration_status':
          description: State of the integration of the resource in the Portal
          type: string
          enum: [OK, KO]
        #——————————————————————————
        'comment':
          description: >
            Comment on the state of the integration of the resource in the
            Portal
          type: string
          #TODO: lang?
        #——————————————————————————
        'integration_errors':
          description: >
            List of all the errors that were encountered during the
            integration of the resource.
          type: array
          items:
            $ref: '#/components/schemas/IntegrationError'

    #---------------------------------------------------------------------------
    'DOI':
      description: Digital object identifier (modern Crossref DOIs version)
      type: string
      pattern: '^10.\d{4,9}/[-.;()/:\w]+$'
      # \d : digit character == [0-9]
      # \w : word character == [0-9a-zA-Z_]
      # /i (at the end) : expression is case insensitive
      #source: https://www.crossref.org/blog/dois-and-matching-regular-expressions/
      #alternative: https://github.com/regexhq/doi-regex/blob/master/index.js

    #---------------------------------------------------------------------------
    'MediaType':
      description: >
        Most common Media types formerly known as MIME types, as definied in
        RFC 2049
      type: string
      enum:
        - 'application/x-executable'
        - 'application/graphql'
        - 'application/javascript' # (.js)
        - 'application/json' # (.json)
        - 'application/ld+json'
        - 'application/msword' # (.doc)
        - 'application/pdf' # (.pdf)
        - 'application/sql'
        - 'application/vnd.api+json'
        - 'application/vnd.ms-excel' # (.xls)
        - 'application/vnd.ms-powerpoint' # (.ppt)
        - 'application/vnd.oasis.opendocument.text' # (.odt)
        - 'application/vnd.openxmlformats-officedocument.presentationml.presentation' # (.pptx)
        - 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' # (.xlsx)
        - 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' # (.docx)'
        - 'application/x-www-form-urlencoded'
        - 'application/xml'
        - 'application/zip' # (.zip)
        - 'application/zstd' # (.zst)
        - 'audio/mpeg' # (.mpeg | .mpg)
        - 'audio/ogg' # (.ogg)
        - 'image/gif' # (.gif)
        - 'image/apng'
        - 'image/flif'
        - 'image/webp'
        - 'image/x-mng'
        - 'image/jpeg' # (.jpeg)
        - 'image/png' # (.png)
        - 'multipart/form-data'
        - 'text/css' # (.css)
        - 'text/csv' # (.csv)
        - 'text/html' # (.html | .htm)
        - 'text/php' # (.php)
        - 'text/plain' # (.txt)
        - 'text/xml' # (.xml)

    #---------------------------------------------------------------------------
    'FileExtension':
      description: Source format of the data
      type: string
      enum:
        - csv
        - doc
        - docx
        - jpg
        - json
        - odt
        - pdf
        - png
        - ppt
        - pptx
        - txt
        - xls
        - xlsx
        - xml

    #---------------------------------------------------------------------------
    'HashAlgorithm':
      description: Method for computing the integrity hash of the data
      type: string
      enum: ['MD5', 'SHA-256', 'SHA-512']
      #TODO: define the thesaurus for the hash algorithms

    #---------------------------------------------------------------------------
    'Theme':
      description: Category for thematic classification of the data
      type: string
      # TODO: "Theme" thesaurus
      # !SKOS!

    #---------------------------------------------------------------------------
    'Keyword':
      description: Tags to help researching the data
      type: string
      # TODO: "Tags" thesaurus
      # !SKOS!

    #---------------------------------------------------------------------------
    'Date':
      description: 'Date in the ISO 8601 format'
      type: string
      format: date-time
      #TODO: timezone + nanosec?

    #---------------------------------------------------------------------------
    'ReferenceDates':
      description: 'Dates of the actions on the data'
      type: object
      required:
        - created
        - updated
      properties:
        'created':
          $ref: '#/components/schemas/Date'
        'validated':
          $ref: '#/components/schemas/Date'
        'published':
          $ref: '#/components/schemas/Date'
        'updated':
          $ref: '#/components/schemas/Date'
        'deleted':
          $ref: '#/components/schemas/Date'

    #---------------------------------------------------------------------------
    'DictionaryList':
      type: object
      required:
        - lang
        - text
      properties:
        'lang':
          $ref: '#/components/schemas/Language'
        'text':
          type: array
          items:
            type: string
            #TODO: possibly set limitations (size, characters allowed, HTML-ready or not)
      example: { lang: 'fr-FR', text: ['abeilles', 'Apis'] }

    #---------------------------------------------------------------------------
    'DictionaryEntry':
      type: object
      required:
        - lang
        - text
      properties:
        'lang':
          $ref: '#/components/schemas/Language'
        'text':
          type: string
          #TODO: possibly set limitations (size, characters allowed, HTML-ready or not)
      example: { lang: 'fr-FR', text: 'abeilles' }

    #---------------------------------------------------------------------------
    'SkosScheme':
      description: >
        Set of SKOS concepts gathered in a transversal and hierarchical
        relationships.
      type: object
      required:
        - scheme_id
        - scheme_label
      properties:
        #——————————————————————————
        'scheme_id':
          description: 'ID of the SKOS concept scheme'
          type: string
          format: uuid
        #——————————————————————————
        'scheme_code':
          description: 'Short abstract code that identifies uniquely the concept scheme'
          type: string
          minLength: 2
          maxLength: 30
        #——————————————————————————
        'scheme_label':
          description: 'Short code for the concept scheme'
          type: array
          items:
            $ref: '#/components/schemas/DictionaryEntry'
          minItems: 1
        #——————————————————————————
        'scheme_icon':
          description: 'URI towards a graphical resource that describes the concept scheme'
          type: string
          format: uri
        #——————————————————————————
        'top_concepts':
          description: 'List of the highest level concepts in the concept scheme'
          type: array
          items:
            $ref: '#/components/schemas/SkosConcept'

    #---------------------------------------------------------------------------
    'SkosConcept':
      description: >
        A SKOS concept is an element in a controlled vocabulary such as a
        thesaurus. It offers to link concepts in hierarchical (broader/narrower)
        or neighbouring relationships.
        A set of SKOS concepts is gathered in one concept scheme.
        If a SKOS concept appears in two different concept schemes, it should be
        duplicated as there are chances the context is slightly different and the
        meaning will be hard to unify.
      type: object
      required:
        - concept_id
        - concept_code
        - skos_scheme_class
        - pref_label
      properties:
        #—•—•—•—•—•—•—•—•—•—•—•—•—•
        # Identification
        #——————————————————————————
        'concept_id':
          description: 'ID of the SKOS concept'
          type: string
          format: uuid
        #——————————————————————————
        'concept_code':
          description: 'Short abstract code that identifies uniquely the concept'
          type: string
          minLength: 2
          maxLength: 30
        #——————————————————————————
        'concept_uri':
          description: 'Web page that document the SKOS concept'
          type: string
          format: uri
        #——————————————————————————
        'concept_icon':
          description: 'URI towards a graphical resource that describes the concept'
          type: string
          format: uri
        #—•—•—•—•—•—•—•—•—•—•—•—•—•
        # Labels
        #——————————————————————————
        'pref_label':
          description: 'Preferred lexical label for the resource, one for each language'
          type: array
          items:
            $ref: '#/components/schemas/DictionaryEntry'
          minItems: 1
        #——————————————————————————
        'alt_labels':
          description: 'List of alternative labels (in each language)'
          type: array
          items:
            $ref: '#/components/schemas/DictionaryList'
        #——————————————————————————
        'hidden_labels':
          description: 'List of alternative orthographs for the label (in each language)'
          type: array
          items:
            $ref: '#/components/schemas/DictionaryList'
        #—•—•—•—•—•—•—•—•—•—•—•—•—•
        # Classification
        #——————————————————————————
        'of_scheme':
          allOf:
            - description: >
                Reference to the constrained vocabulary, thesaurus or classification scheme
              type: object
            - $ref: '#/components/schemas/SkosScheme'
        #——————————————————————————
        'concept_role':
          description: >
            Underlines a particular use for this Concept, e.g. a potential
            value for a property (e.g. "metadata.theme", "metadata.keywords",
            "metadata.licence")
          type: string
        #—•—•—•—•—•—•—•—•—•—•—•—•—•
        # Relationships
        #——————————————————————————
        'broader_concepts':
          description: >
            References to the 'parent' SKOS concepts with a broader scope
            than the current concept
          type: array
          items:
            $ref: '#/components/schemas/SkosConcept'
          # beware to avoid graph loops with narrower (children) or
          # siblingly (neighbours) concepts !
        #——————————————————————————
        'narrower_concepts':
          description: >
            References to the 'children' SKOS concepts with a narrower scope
            than the current concept
          type: array
          items:
            $ref: '#/components/schemas/SkosConcept'
          # beware to avoid graph loops with broader (parents) or
          # siblingly (neighbours) concepts !
        #——————————————————————————
        'siblings_concepts':
          description: >
            References to the SKOS concepts that are neighbouring meanings
            of the current concept
          type: array
          items:
            $ref: '#/components/schemas/SkosConcept'
          # beware to avoid graph loops with broader (children) or
          # narrower (children) concepts !
        #——————————————————————————
        'relative_concepts':
          description: >
            References to the SKOS concepts that can be associated in a
            non-transitive relationship
          type: array
          items:
            $ref: '#/components/schemas/SkosConcept'
        #—•—•—•—•—•—•—•—•—•—•—•—•—•
        # Documentation
        #——————————————————————————
        'scope_note':
          description: >
            Contextual information about the intended meaning of the concept,
            especially as an indication of how the use of the concept
          type: array
          items:
            $ref: '#/components/schemas/DictionaryEntry'
        #——————————————————————————
        'concept_definition':
          description: 'Complete explanation of the intended meaning of a concept'
          type: array
          items:
            $ref: '#/components/schemas/DictionaryEntry'
        #——————————————————————————
        'concept_example':
          description: 'Example of the use of a concept'
          type: array
          items:
            $ref: '#/components/schemas/DictionaryEntry'

    #---------------------------------------------------------------------------
    'Language':
      description: >
        Lowercase ISO-639 language code followed by the
        uppercase 2 letter ISO 3166-1 alpha-2 country code,
        both joined by an hyphen-minus sign, or alternatively the
        lowercase ISO-639 language code alone
      type: string
      pattern: '^[a-z]{2}(-[A-Z]{2})?$'
      enum:
        [
          'cs-CZ',
          'da-DK',
          'de-CH',
          'de-DE',
          'en-GB',
          'en-US',
          'el-GR',
          'es-ES',
          'fr-FR',
          'hu-HU',
          'it-IT',
          'no-NO',
          'pl-PL',
          'pt-PT',
          'ro-RO',
          'ru-RU',
          'sk-SK',
          'cs',
          'da',
          'de',
          'en',
          'el',
          'es',
          'fr',
          'hu',
          'it',
          'no',
          'pl',
          'pt',
          'ro',
          'ru',
          'sk',
        ]

      # norm: https://www.rfc-editor.org/rfc/bcp/bcp47.txt
      # source for enum: https://app.swaggerhub.com/apis/nologo/thesaurus/1.0.0#/default/get_thesaurus_v1

      # !SKOS!

  #TODO : thesaurus : tableau de valeurs simples ou couples {label: "Texte à
  #       afficher pour l'utilisateur", "valeur": "ValeurAssociee"}

  #=============================================================================
  responses:
    #---------------------------------------------------------------------------
    'Error400BadRequest':
      description: The JSON is not valid.
      content:
        application/json:
          schema:
            type: object
            properties:
              'status_code':
                type: integer
                enum: [400]
              'message':
                type: string
                enum: ['The JSON is not valid.']
    #---------------------------------------------------------------------------
    'Error401Unauthorized':
      description: The request requires a user authentication.
      content:
        application/json:
          schema:
            type: object
            properties:
              'status_code':
                type: integer
                enum: [401]
              'message':
                type: string
                enum: ['The request requires a user authentication.']
    #---------------------------------------------------------------------------
    'Error403Forbidden':
      description: The access is not allowed.
      content:
        application/json:
          schema:
            type: object
            properties:
              'status_code':
                type: integer
                enum: [403]
              'message':
                type: string
                enum: ['The access is not allowed.']
    #---------------------------------------------------------------------------
    'Error404NotFound':
      description: The resource was not found.
      content:
        application/json:
          schema:
            type: object
            properties:
              'status_code':
                type: integer
                enum: [404]
              'message':
                type: string
                enum: ['The resource was not found.']
    #---------------------------------------------------------------------------
    'Error405MethodNotAllowed':
      description: Request method is not supported for the requested resource.
      content:
        application/json:
          schema:
            type: object
            properties:
              'status_code':
                type: integer
                enum: [405]
              'message':
                type: string
                enum: ['Request method is not supported for the requested resource.']
    #---------------------------------------------------------------------------
    'Error406NotAcceptable':
      description: Headers sent in the request are not compatible with the service.
      content:
        application/json:
          schema:
            type: object
            properties:
              'status_code':
                type: integer
                enum: [406]
              'message':
                type: string
                enum: ['Headers sent in the request are not compatible with the service.']
    #---------------------------------------------------------------------------
    'Error408RequestTimeout':
      description: >
        The client did not produce a request within the time that the server was
        prepared to wait. The client may repeat the request without
        modifications at any later time.
      content:
        application/json:
          schema:
            type: object
            properties:
              'status_code':
                type: integer
                enum: [408]
              'message':
                type: string
                enum:
                  [
                    'The client did not produce a request within the time that the server was prepared to wait. The client may repeat the request without modifications at any later time.',
                  ]
    #---------------------------------------------------------------------------
    'Error410Gone':
      description: >
        The requested resource is no longer available and will not be available
        again. The resource should be purged from the client system.
      content:
        application/json:
          schema:
            type: object
            properties:
              'status_code':
                type: integer
                enum: [410]
              'message':
                type: string
                enum:
                  [
                    'The requested resource is no longer available and will not be available again. The resource should be purged from the client system.',
                  ]
    #---------------------------------------------------------------------------
    'Error423Locked':
      description: The resource that is being accessed is locked.
      content:
        application/json:
          schema:
            type: object
            properties:
              'status_code':
                type: integer
                enum: [423]
              'message':
                type: string
                enum: ['The resource that is being accessed is locked.']
    #---------------------------------------------------------------------------
    'Error429TooManyRequests':
      description: The user has sent too many requests in a short period.
      content:
        application/json:
          schema:
            type: object
            properties:
              'status_code':
                type: integer
                enum: [429]
              'message':
                type: string
                enum: ['The user has sent too many requests in a short period.']
    #---------------------------------------------------------------------------
    'Error500InternalServerError':
      description: An unexpected error occured.
      content:
        application/json:
          schema:
            type: object
            properties:
              'status_code':
                type: integer
                enum: [500]
              'message':
                type: string
                enum: ['An unexpected error occured.']
    #---------------------------------------------------------------------------
    'Error503ServiceUnavailable':
      description: The server is currently unable to handle the request.
      content:
        application/json:
          schema:
            type: object
            properties:
              'status_code':
                type: integer
                enum: [503]
              'message':
                type: string
                enum: ['The server is currently unable to handle the request.']

  #=============================================================================
  securitySchemes:
    authRudi:
      type: oauth2
      description: >
        This API uses OAuth 2 with the implicit grant flow.
        #[More info](https://api.example.com/docs/auth)
      flows:
        implicit:
          authorizationUrl: https://api.example.com/oauth2/authorize
          scopes:
            portal: RUDI Portal actions
            backoffice: Actions accessible from the backoffice UI
            backadmin: Actions accessible from the backoffice admin
            node: Local Producer node actions (private actions)
#•••••••••••••••••••••••••••••••••••[ EOF ]••••••••••••••••••••••••••••••••••••#
